---
title: "인턴 교육 2주차 과제:"
draft: true
---

-  제출일: 2024년 6월 일 요일
-  제출자: 배정환 인턴

**세부과제**
1. 네이버 OPEN API 이용
    - 검색어에 대한 20개의 상품을 찾는다.
    - 중고, 렌탈은 제외한다.

2. Pandas를 이용한 데이터프레임 저장
    - 출력된 각 key들의 의미에 대해 이해한다.
    - (column: 상품id, 상품명, 제조사, 최저가, 이미지링크, 구매링크)을 가진 데이터프레임을 만든다.(변수명은 자유)
    - csv로 저장한다.
3. Python 코드로 함수 작성
    - 키워드(검색어)만 입력하면 바로 저장될 수 있도록 함수를 만든다.

**목표**

업무 자동화 시스템을 만들면서 OPEN API에 대한 이해와 데이터 저장에 대한 스킬을 높인다.

**팁**
- 모든 정보에 대한 검색은 공식 문서를 가장 먼저 확인해보는 것이 좋다.
1. [네이버 OPEN API에 대한 가이드](https://developers.naver.com/docs/common/openapiguide/)
2. [Pandas API reference](https://pandas.pydata.org/docs/reference/index.html)
3. [Python Documentation](https://docs.python.org/ko/3/)

### 2024-06-05

1. 일단 처음 API 를 함수에 연결하는 법에 대해서부터 해본다.
	- `display=20`: 검색어에 대한 20개의 상품이 출력되도록  했다.
	-  `&exclude=used:rental`: 중고와 렌탈을 제외했다.
```python
import os
import urllib.parse
import urllib.request

from dotenv import load_dotenv
load_dotenv()

def searh_naver_shopping(keyword):
    client_id = os.getenv("NAVER_CLIENT_ID")
    client_key = os.getenv("NAVER_CLIENT_KEY")
    encrypt_text = urllib.parse.quote(keyword)

    url = "https://openapi.naver.com/v1/search/shop?query="+ encrypt_text +"&display=20&exclude=used:rental"

    req_url = urllib.request.Request(url)
    req_url.add_header("X-Naver-Client-Id", client_id)
    req_url.add_header("X-Naver-Client-Secret", client_key)

    response = urllib.request.urlopen(req_url)
    resp_code = response.getcode()

    if resp_code == 200:
        shop_output = response.read().decode("utf-8")
    else:
        shop_output = "Error" + resp_code
    return shop_output

keyword_input = searh_naver_shopping("반팔티")
print(keyword_input)
```

- 첫번째 과제 Clear
---
2. Pandas를 이용한 데이터프레임 저장
- 위의 코드로 받은 json파일은 string으로 되어있다. 이를 바꿀려면
```python
import json

# 받은 json파일의 텍스트를 text로 칭할 때
json.loads(text)
```
- csv파일로 바꾸기 위해서는 `to_csv()`함수를 써야한다고 하셨다.
- pandas에서 json파일을 읽는 방법
![](https://imgur.com/hWNGkQa.png)

- `read_json`함수에 path를 넣으면 되지 않을까?
- 일단 함수에 나오는 출력값을 json파일에 옮겨 넣어야한다.
- [[과제 공부용#파일 입출력에 대하여| Python 파일 입출력]] 
- [[과제 공부용#json.dump와 json.dumps의 차이 & json.loads에 대하여|json.dump와 json.dump/json.load와 json.loads의 차이]] 
```python
import json
import pandas as pd

json_input = json.loads(keyword_input)
# print(json_input)
print(json.dumps(json_input))
# shop_review=pd.read_json(path_or_buf="", orient=json_input)
with open("naver_news_shopping.json", 'w', encoding="utf-8") as json_file:
    json.dump(json_input, json_file, ensure_ascii=False, sort_keys=True, indent="\t")
```

---
### 2024-06-07
- json파일로 만든 것을 보고 DataFrame으로 만든다.
	- column: 상품id, 상품명, 제조사, 최저가, 이미지링크, 구매링크)을 가진 데이터프레임을 만든다.(변수명은 자유)
	- 이때 `read_json`을 쓰면 될거 같다.
	- [[과제 공부용#pandas.read_json|pandas.read_json]]
```python
# naver_news_shopping.json의 경로를 설정해준다.
df = pd.read_json('naver_shopping.json')
df
```

---
### 2024-06-08
#### Key value in JSON file to columns in DataFrame
- rename에 대한 방법
- set_axis에 대한 방법 [set_axis](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.set_axis.html)
- rename_axis에 대한 방법
- pivot_table에 대한 방법 - item열에 있는 것을 columns로 바꾼다는 아이디어

---
### 2024-06-09
- [stackoverflow에서 찾은 방법](https://stackoverflow.com/questions/44802160/convert-json-api-response-to-pandas-dataframe)
- [json_normalize 문서](https://pandas.pydata.org/docs/reference/api/pandas.json_normalize.html#pandas-json-normalize)
- `items` column에 있던 value를 `json_normalize()` 함수를 써서 그 row에 있는 value들만 dataframe에 집어 넣었다.
- `json_input`은 API에서 받은 데이터 list이다. 
- 그중 `items`항목을 지정해서 value값으로 되어있는데 상품ID,상품명등을 분리할 수 있었다.
```python
from pandas import json_normalize

shopping_info = json_normalize(json_input["items"])
shopping_info
```
![](https://imgur.com/KrbSJVR.jpg)

- `json_normalize`에 대해서는 내일 회사 가서 좀 더 자세히 봐야겠다.
-  **남은 과제 :**
	- **이 DataFrame의 불필요한 column들 삭제하고 조건에 맞게 만들고 CSV파일로 저장하기**
	- **함수에 DataFrame만드는거 까지 연결해서 함수에 키워드를 집어 넣으면 자동으로 csv파일 만들어지게 하기**

---
